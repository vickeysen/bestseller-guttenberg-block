<?php
/*
Plugin Name: Biblio Bestseller Block
Description: A custom Gutenberg block to display the current best-selling book in a selected genre.
Version: 1.0
Author: Vikash sain
*/


// Exit if accessed directly.
if (!defined('ABSPATH')) {
    exit;
}

function biblio_bestseller_block_init() {
    wp_register_script(
        'biblio-bestseller-block',
        plugins_url('build/index.js', __FILE__),
        array('wp-blocks', 'wp-element', 'wp-editor', 'wp-components', 'wp-i18n')
    );

    wp_register_style(
        'biblio-bestseller-block-editor',
        plugins_url('src/editor.css', __FILE__),
        array('wp-edit-blocks')
    );

    wp_register_style(
        'biblio-bestseller-block',
        plugins_url('src/style.css', __FILE__),
        array()
    );

    register_block_type('biblio/bestseller', array(
        'editor_script' => 'biblio-bestseller-block',
        'editor_style'  => 'biblio-bestseller-block-editor',
        'style'         => 'biblio-bestseller-block',
        'render_callback' => 'biblio_bestseller_block_render'
    ));
}

add_action('init', 'biblio_bestseller_block_init');

function biblio_bestseller_block_render($attributes) {
    $genre = isset($attributes['genre']) ? $attributes['genre'] : '';

    ob_start();
    ?>
    <div class="biblio-bestseller-block">
        <h2 class="title"><?php echo esc_html($attributes['title'] ?? 'Bestsellers'); ?></h2>
        <div class="book-details">
        <img class="bookImg" src="<?php echo esc_html($attributes['bookData']['image'] ?? $attributes['bookData']['image']); ?>">
        <span class="bookName"><?php echo esc_html($attributes['bookData']['name'] ?? $attributes['bookData']['name']); ?></span>
        <span class="author"><?php echo esc_html($attributes['bookData']['author'] ?? $attributes['bookData']['author']); ?></span>
        <div class="buyButtonWrap"><a class="buyButton" href="<?php echo esc_html($attributes['bookData']['url'] ?? $attributes['bookData']['url']); ?>">BUY FROM AMAZON</a></div>
        <div class="bottomLogoWrap"><img class="bottomLogo" src="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiB2aWV3Qm94PSIwIDAgNjcgOTUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIGZvY3VzYWJsZT0iZmFsc2UiIGFyaWEtaGlkZGVuPSJ0cnVlIj48bWFzayBpZD0ibG9nby1wZW5ndWluX3N2Z19fYSIgaGVpZ2h0PSI5NSIgbWFza1VuaXRzPSJ1c2VyU3BhY2VPblVzZSIgd2lkdGg9IjY3IiB4PSIwIiB5PSIwIj48cGF0aCBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Im0wIC41NTg1OTRoNjYuNzk4NHY5NC4wMDg0MDZoLTY2Ljc5ODR6IiBmaWxsPSIjZmZmIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjwvcGF0aD48L21hc2s+PGcgbWFzaz0idXJsKCNsb2dvLXBlbmd1aW5fc3ZnX19hKSI+PHBhdGggY2xpcC1ydWxlPSJldmVub2RkIiBkPSJtMzMuMzE4Ni41NTg2NjljLTMxLjk3OTY5LjA2NjQ0MS0zMy4zMzE0MTQ5IDM5Ljk0NzAzMS0zMy4zMTg1NzMyNCA0Ny4yNjk2MzEuMDQwNzU4MzQgMjIuMjIzMyA5LjA5MjQ1MzI0IDQ2Ljc4NzggMzMuNDg5OTczMjQgNDYuNzM4NiAyNC4zOTAyLS4wNDU4IDMzLjM0NjQtMjQuNzk2NyAzMy4zMDg1LTQ3LjAxODktLjAxNDUtNy4zMjQ4LTEuNTA2NC00Ny4wNTI0MjMtMzMuNDc5OS00Ni45ODkzMzEiIGZpbGw9IiMxYzFjMWIiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PC9wYXRoPjwvZz48ZyBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PHBhdGggZD0ibTMzLjQ4OTcgOTMuMjI5N2MtMjMuMTcyLjA0NzQtMjkuNDI3NTQtMjQuNTk3NC0yOS40Njc3NC00NS43MDY5LS4wMTI4NC02Ljk1NjgtMS4xODQ3OC00NS44MDIyNyAyOS4xOTEzNC00NS44NjI1NyAzMC4zNzQ1LS4wNjE5OCAyOS41MzgxIDM4Ljk4NzI3IDI5LjU2MSA0NS45NDU3Ny4wMzc5IDIxLjExNzktNi4xMDcxIDQ1LjU4NjgtMjkuMjg0NiA0NS42MjM3IiBmaWxsPSIjMWMxYzFiIj48L3BhdGg+PHBhdGggZD0ibTMzLjQ4OTcgOTMuMjI5N2MtMjMuMTcyLjA0NzQtMjkuNDI3NTQtMjQuNTk3NC0yOS40Njc3NC00NS43MDY5LS4wMTI4NC02Ljk1NjgtMS4xODQ3OC00NS44MDIyNyAyOS4xOTEzNC00NS44NjI1NyAzMC4zNzQ1LS4wNjE5OCAyOS41MzgxIDM4Ljk4NzI3IDI5LjU2MSA0NS45NDU3Ny4wMzc5IDIxLjExNzktNi4xMDcxIDQ1LjU4NjgtMjkuMjg0NiA0NS42MjM3IiBmaWxsPSIjZmY2NDAxIj48L3BhdGg+PHBhdGggZD0ibTQ4Ljc3MTMgMzYuODk2Yy0yLjcxOTYtNC4zNDExLTYuNTQxNC05LjQ2NTUtNi45Njg1LTE0LjczMzktLjI2NjMtMy4zMTAzLS4wNzE1LTcuMDA5My0yLjI5ODEtOS43MzY4LS42NDk5LS43OTk1LTEuNTYwNi0xLjUyOTgtMi40Njg0LTIuMDAxLS45NzU0LS41MDU4OC0yLjIyMDUtLjgyODYtMy4zMjQzLS44Mjg2LTEuMDMyOSAwLTIuMDcyLjE2MTM2LTMuMDU5MS40NjAxLTEuMTcyNS4zNTM0LTIuMzMzOS43NzEtMy41NTEuOTQxOS0xLjQwOTguMTk2NS0yLjU0MzguMTI1Ni0zLjkxNzMtLjE3OTgtLjgxOTEtLjE4MzEtMS4wNDQxLS4yNDczLTEuODYzMi0uNDI0My0uNDUyMi0uMDk4My0xLjY3ODMtLjQ1NDUyLTIuMDY5MS0uMDcyMS0uOTI0MS45MjY5IDEuMDM1NyAyLjA0NjkgMS42MjQyIDIuNDY0NSAxLjI4NDEuOTMxMyAxLjgxNDUgMS4yNDIzIDMuMDM5IDIuMjk0OCAxLjY1MSAxLjQzNiAyLjk2NDIgMy4xNDUxIDMuNDcgNS4yODM1LjE0MjkuNjE1OC4xOTE1IDEuMjQyOC4xOTcxIDEuODgzMi4xMjI4IDkuMjMyMS0xNS4yODcyIDE4LjI5NzItMTUuMDc2NyAzNC42NTA4LjA3MTUgNS43ODQ5IDMuMTU5MSA2LjczNDYgMy4xMjE3IDMuNTI4Ni0uMDU0Mi0zLjgwODkgMS4yOTg2LTcuOTIzMyAyLjcwMDYtMTEuNDU0Ny4zMjUtLjgxNTggMS4zNjEyLTEuMDYxNCAxLjEyOS4zNTM0LS4zNjEzIDIuMjM4OS0xLjI4MTQgNi4xMTQzLTEuMTk1NCAxMi40MzE4LjAxMzkgMS41MjQzLjExMTEgMy4wNjE5LjMyNDkgNC41Nzc4LjE3OTggMS4yMDk0LjQ0NTYgMi40MTQyLjc5NjIgMy41OTYyLjI5Ny45OTA1LjY4MjkgMS45NDQ3IDEuMTYxMyAyLjg1NTQuMzg5Mi43MTk2LjgzNjQgMS40MDc1IDEuMzY0MSAyLjAzMTIuNTE0Mi42MTQxIDEuMDY4NiAxLjA2NTggMS42OTA2IDEuNTUzMy4zNjEyLjI4ODYuNzY5OS41Mzc2Ljk0NDEuOTk3Ny4yNTEzLjY2MDUtLjYwMTkuOTI5MS0xLjA0NjggMS4xMzQtLjQ5MDguMjIwNS0uOTIwMi40Njc4LTEuMzg0Mi42OTQ1LS42NjQ5LjMyMjctMS4zMjcxLjY3MDYtMS45NzQ4IDEuMDI2My0uMzk2NC4yMjc4LS44NDg2LjM2MTItMS4yMzI4LjYyODEtLjM3OTYuMjQ1Ni0uNTczOS42NTk5LjAyMjkuNzQ4MS4yNjguMDUxNC41NTgzLS4wMjUxLjgzOTItLjA0MDIuNDY1MS0uMDE0NS45NjQyLS4wNzk4IDEuNDA5Mi4wOTE2LjYwNDEuMjM4NC41NzQuODE2OS41OTY5IDEuMzc5MS4wMjUxLjYxMTkuNDQ0NC44MDk2Ljk4OTkuNjYxMS42MjE0LS4xNzY1IDEuMDU4Ni0uNjU4OSAxLjU0MzItMS4wNjIuMzU0Ni0uMjk3Ljc0NDktLjYwNDEgMS4xNTMtLjgxMzUuODMzNi0uNDE1OSAxLjgyNjktLjI3NjQgMi43MjI0LS4yMzM0LjQ5NDIuMDI2MyAxLjE5NTQuMjM3MyAxLjU5ODUtLjE2NTguNDEwNC0uNDE2NS4xMTM0LTEuMTIxMS0uMDY4Ni0xLjU3NS0uMTY4MS0uNDM2MS0uMzc4Ni0uODUzNy0uNTkzNS0xLjI2OC0uMS0uMTg5OS0uMjM3My0uMzU5LS4zMjIyLS41NTUtLjM0NTEtLjgwNjIgMi40NTYxLTEuNDEyIDIuODU5OC0xLjUyOTggMS4zNjQtLjM2MzUgMi43OS0uNjg4NSA0LjE5MTQtLjc5ODUgMS4zMzU1LS4xMTc4IDIuODA2Mi0uMTI1NiA0LjA2MzUuMzk1OS41NDIyLjIyNTYuOTgyMS42MDk3IDEuMzM4OSAxLjA2NDIuMjA1NS4yNDg0LjY3MTEgMS4wMDExLjI1NjMgMS4zMDc2LS42NDcxLjQ3MzUtMS4zMjA1Ljg4MzMtMS45NDM2IDEuMzgzNi0uMzk5Mi4zMDc2LS43ODExLjYzMDMtMS4xMjExIDEuMDE2Ny0uMjUzNS4yODE0LS4zMjIyLjc4NzIuMTkyMS43NTU0LjY4MTEtLjAzMTMgMS4zNjM0LS4wNjg3IDIuMDM5LS4wNzIuNDg1OC0uMDAyMyAxLjAxMTEuMDY3IDEuNDIyMS4zNDI4LjY2NS40NTQ1LjgxMDcgMS40MjQ5IDEuNTYzOSAxLjc5NTYuMjA3Ny4xMDUuNDY1MS4xMDUuNjkwMS4wMzYzLjQ5NDEtLjE1MzYuNzIxOS0uNjY1Ljk4ODItMS4wNjQyLjI0NTEtLjM1NTcuNDkwOC0uNzEzNS44ODIyLS45MjkxLjI0MTItLjEzMjMuNTE4Ny0uMTgzNy43OTU2LS4xODM3LjQ5NjQgMCAuOTk1NS4wMDkgMS40OTE5LjA2MDMuMzkzNi4wNTE0LjkyODUuMjMzNCAxLjI3NjMtLjAzMTguNjU1NS0uNTEwMy0xLjA3MzYtMS42NDY1LTEuNDIxNS0xLjg2NTktLjc4NzgtLjQ5MTQtMS45MTQ1LTEuMDEwNi0yLjE2MjQtMi4wMjU3LS4yODM2LTEuMTkwOS4yOTY1LTIuNDMyMS44MDA2LTMuNDgwMS41MjU0LTEuMTEyMiAxLjI0MTItMi4xMzA2IDEuNjQ3MS0zLjMwMDguMzg0Ny0xLjA3MDkuNjcxMS0yLjE4NjUuODM0Mi0zLjMxOTMuODYzMi02LjE4NDEtLjU3NTEtMTIuNzY1Ny0yLjM3ODUtMTguNjY5Ni0uMjE2MS0uNzA2My0uNDg2OS0xLjQxMDMtLjcwMTMtMi4xMTY2LS4zMTIxLTEuMTE1Ni43Njk5LTEuMzc5NiAxLjMyNDQtLjI5Ny41Mjc2IDEuMDQ2OCAzLjk4OTMgNy43MDE2IDUuMDAyMSAxMi42NDY4LjYzNyAzLjE1NzMgMy4wMTE2IDMuMjgyNCAyLjk0MjQtMi4zMTI2LS4wOTIxLTguMTExNS0zLjE0NzMtMTMuOTY5NS02Ljg5NzctMTkuOTMxNCIgZmlsbD0iIzFjMWMxYiI+PC9wYXRoPjxwYXRoIGQ9Im00NS45MTQyIDYxLjMwNzNjLjQxOTMgNC4wODA5Ljg3MTYgMTEuMTIwOS00LjExMTUgMTEuMzU5OS0xLjMyMDUuMDYzMS0yLjk2MjYtLjg2MDQtNS40MDg2LS42OTU3LTQuMTQ5NS4yODUzLTUuMzg1MSAxLjg3NTQtOC43NzUzIDEuMjY2OS0xLjk0MjUtLjM0NDUtMy4zNzUyLTEuNDQxNy00LjE5MTQtMy4zMjE2LS45MjU4LTIuMTM5NS0xLjAwNS00LjU2MjctMS4xNTM2LTYuODYwMi0uMTU2My0yLjU2NS0uMTU2My01LjE1MTgtLjAwNTUtNy43MTk1LjExNDQtMS44NTU0LjMwNzYtMy43MDY4LjU1MzMtNS41NTMyLjQwNTktMy4wNjI1IDEuMDU2My02LjA4NDIgMS43NTQ4LTkuMDkwMi42MTE0LTIuNjQ4MiAxLjI1MzUtNS4zMDQyIDIuMzk3NS03Ljc5MjcuODM5Mi0xLjgxNDYgMi4wODQyLTMuNTYzOCAzLjkzMjMtNC40ODk2IDIuMDEzNC0xLjAwNjYgNC44MzE4LTEuMDgwOSA2LjgxMjgtLjA2ODEgNC40ODUxIDIuMzAwNCA0LjM3NDYgNy42NTMxIDQuNTE3NSAxMi4wMDI1LjExMzMgMy4zNTA2LjUyNzYgNi43OTI3IDEuMTM2MiAxMC4wODguNjYzOSAzLjY2MjEgMi4xNTQ2IDcuMTQ4MyAyLjU0MTUgMTAuODczNSIgZmlsbD0iI2ZmZiI+PC9wYXRoPjxwYXRoIGQ9Im0zOC42NjAzIDE2LjQyNjRjLjkxOSAxLjA3NTQuODYyIDUuNTE1OC0uNjQ0NCA3LjA1MzUtLjg3NzEuOTAxNy0yLjM2NjcgMS4wMTg0LTMuNTM4NyAxLjE4NTMtMS4yOTg3LjE4NDMtMi41Njg5LjQ3MDEtMy44NTAyLjc4OTUtMS4yMjA2LjI5NzYtMS4xMzU3LS45OTIyLjAzNzktMS45MTUxIDEuNzU0OS0xLjM3NTIgNi4xNTg0LTEuOTg1NCA3LjIxOTgtNy4xMTMyLjAzNjktLjE5NDMuMjUxMy0uNjE0MS43NzU2IDAiIGZpbGw9IiNmZmYiPjwvcGF0aD48cGF0aCBkPSJtMzIuMjc3MSAxNy41OWMxLjIyNjEuNzk5NSAyLjk4MTUuMjgyNSAzLjkxNS0xLjE1NTguOTMzNi0xLjQzODIuNjk1Ny0zLjI1LS41MzcxLTQuMDUwMS0xLjIyODktLjc5NTEtMi45ODcxLS4yNzkyLTMuOTIzNCAxLjE1NjktLjkzMDcgMS40Mjk5LS42ODc5IDMuMjQ2Ny41NDU1IDQuMDQ5IiBmaWxsPSIjZmZmIj48L3BhdGg+PHBhdGggZD0ibTMzLjQzNTcgMTQuNzk0NGMuNDUzNC0uNjc1MSAxLjI2NjktLjkyMjQgMS44MDktLjU1NS41MzI3LjM2ODUuNTk2OSAxLjIxMDQuMTM2MyAxLjg4NzctLjQ1ODQuNjcyOC0xLjI2NjMuOTIxMi0xLjgwMzUuNTU2MS0uNTQyNy0uMzcwNy0uNjAxOC0xLjIxNjEtLjE0MTgtMS44ODg4IiBmaWxsPSIjMWMxYzFiIj48L3BhdGg+PC9nPjwvc3ZnPg==" alt="Logo"></div>
        </div>
        
    </div>
    <?php
    return ob_get_clean();
}
